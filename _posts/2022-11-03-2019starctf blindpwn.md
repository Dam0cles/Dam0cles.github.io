---
layout: post
title: StarCTF2019-PWN-BlindPwn
tags: [pwn]
excerpt: å¹´è½»äººçš„ç¬¬ä¸€æ¬¡ç›²æ ˆæº¢å‡º
---

## ä¿¡æ¯æ”¶é›†
ç¨‹åºæä¾›äº†ç›¸å…³æè¿°ï¼š

- [x] ç¨‹åºä¸º64ä½
- [x] æä¾›äº†libcç‰ˆæœ¬(libc-2.23.so: ELF 64-bit LSB shared object)
- [x] æœªå¼€å¯PIEã€full relroåŠcanary

æ¨¡æ‹Ÿç¨‹åºè¿œç¨‹ç¯å¢ƒï¼š

![](/assets/img/starCTF/blindpwn/1.png)


æ¢æµ‹æº¢å‡ºé•¿åº¦ï¼š

![](/assets/img/starCTF/blindpwn/2.png)

![](/assets/img/starCTF/blindpwn/3.png)

çœ‹åˆ°å½“offset=41æ—¶æ²¡æœ‰è¾“å‡º"GoodBye",è¯´æ˜è¿”å›åœ°å€è¢«ç¯¡æ”¹ï¼Œè¯´æ˜æº¢å‡ºé•¿åº¦ä¸º40ã€‚

æ¥ä¸‹æ¥å¯ä»¥æº¢å‡ºä¸€ä½ï¼Œçœ‹çœ‹èƒ½è¾¾åˆ°ä»€ä¹ˆæ•ˆæœï¼š

![](/assets/img/starCTF/blindpwn/8.png)

ğŸ‘†å½“æº¢å‡ºä¸€ä½ä¸º0x5æˆ–è€…0x76æ—¶ï¼Œç¨‹åºæ­£å¸¸è¿è¡Œï¼Œæ¨æµ‹0x5æˆ–è€…0x76ä¸ºåŸæ¥çš„æ•°æ®ã€‚


![](/assets/img/starCTF/blindpwn/5.png)

![](/assets/img/starCTF/blindpwn/6.png)

![](/assets/img/starCTF/blindpwn/7.png)

ğŸ‘†å½“æº¢å‡ºä¸€ä½ä¸º0x0a/0x0f/0x14æ—¶ï¼Œç¨‹åºä¼šæ‰“å°ä¸€äº›æ•°æ®ã€‚ä»”ç»†è§‚å¯Ÿï¼Œå‘ç°æ‰“å°çš„æ•°æ®é‡å‡ä¸º0x100,ä¸”ä¼šè¾“å‡º0x00å­—ç¬¦ï¼Œè¯´æ˜:
1. ä½¿ç”¨çš„è¾“å‡ºå‡½æ•°ä¸ä¸ºputsã€printfï¼Œå¯èƒ½ä¸ºwrite;
2. è¾“å…¥å‡½æ•°æ¥æ”¶0x100åï¼Œå¯„å­˜å™¨æœªè¢«æ¸…ç©ºï¼Œå¯¼è‡´è¾“å‡ºå‡½æ•°æ¥æ”¶0x100ä¸ªå­—ç¬¦;
3. è¾“å‡ºçš„å†…å®¹ä¸­åŒ…å«åœ°å€0x4005XX~0x4007XXï¼Œæ¨æµ‹ä¸ºç¨‹åºä»£ç æ®µåœ°å€
éªŒè¯3. ï¼š
![](/assets/img/starCTF/blindpwn/13.png)

![](/assets/img/starCTF/blindpwn/12.png)

ğŸ‘†å½“è¾“å…¥åœ°å€ä¸º0x400520æ—¶ï¼Œç¨‹åºè¾“å‡º0x100å­—èŠ‚ã€‚0x20!= 0x0a/0x0f/0x14ï¼Œæ¨æµ‹æ˜¯ç¬¬äºŒä½0x40XX20ä¸å®ƒä»¬ä¸‰è€…ä¸åŒã€‚

ğŸ‘†å½“è¾“å…¥åœ°å€ä¸º0x400570æ—¶ï¼Œç¨‹åºæ‰“å°äº†ä¸¤æ¬¡"Welcome to this blind pwn!\n"ä¸”å…è®¸ç”¨æˆ·ç»§ç»­è¾“å…¥ï¼Œæ‰€ä»¥ä¸»å‡½æ•°åœ°å€ä¸º0x400570ã€‚

è‡ªå·±åœ¨æœ¬åœ°å†™ä¸€ä¸ªä½¿ç”¨writeå‡½æ•°è¿›è¡Œè¾“å‡ºçš„ç¨‹åºï¼Œæ‰“å°åç¼–è¯‘ç»“æœï¼š

![](/assets/img/starCTF/blindpwn/9.png)

å¯ä»¥çœ‹å‡ºï¼Œå®é™…ä¸Šå½“æº¢å‡ºä¸€ä½ä¸º0x0aï¼Œç±»æ¯”ä¸Šå›¾çš„0x4011aeå¤„ï¼ˆå­—èŠ‚ç ä¸åŒï¼Œé•¿åº¦ä¸ä¸€å®šä¸º7ï¼‰ï¼Œæ­¤æ—¶rdxå¯„å­˜å™¨çš„å€¼ç»§æ‰¿äºç¨‹åºåŸæ‰§è¡Œæµä¸­è¾“å…¥å‡½æ•°èµ‹äºçš„0x100,æ‰€ä»¥è¾“å‡ºäº†"GoodBye!"åŠå…¶åé¢åŠ èµ·æ¥å…±0x100å­—èŠ‚çš„dataæ®µæ•°æ®ï¼›

å½“æº¢å‡ºä¸€ä½ä¸º0x0fï¼Œç±»æ¯”ä¸Šå›¾çš„0x4011b5ï¼Œæ­¤æ—¶rdxå¯„å­˜å™¨ä¸º0x100ï¼Œrsiä¸ºæ ˆåœ°å€ï¼ˆæä¾›ç»™è¾“å…¥å‡½æ•°çš„è¾“å…¥ç¼“å†²åŒºåœ°å€ï¼‰ï¼Œæ‰€ä»¥è¾“å‡ºäº†æ ˆä¸Šçš„0x100æ•°æ®ï¼›

æº¢å‡ºä¸€ä½ä¸º0x14ç±»æ¯”ä¸Šå›¾çš„4011baï¼Œæ•ˆæœä¸æº¢å‡ºä¸€ä½ä¸º0x0fä¸€æ ·ã€‚

ç”±äºç¨‹åºä¸º64ä¸ºï¼Œæ¥ä¸‹æ¥éœ€è¦æ‰¾åˆ°pop rdi;retå’Œpop rsi;retçš„GadgetæŒ‡ä»¤åœ°å€ï¼Œæ‰èƒ½åœ¨æ„é€ ROPé“¾æ—¶æ„é€ å‡½æ•°å‚æ•°ã€‚

æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªç¨‹åºå­˜åœ¨__libc_csu_initå‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°çš„æœ«å°¾å­˜åœ¨ret2csuä¸­å¿…è¦çš„Gadgetï¼š

![](/assets/img/starCTF/blindpwn/10.png)

pop r14;pop r15;retå¯ä»¥å˜å½¢ä¸ºpop rsi;pop r15;ret, pop r15;retå¯ä»¥å˜å½¢ä¸ºpop rdi;ret:

![](/assets/img/starCTF/blindpwn/11.png)


å‡½æ•°__libc_csu_inité€šå¸¸ä½äºç¨‹åºå‘˜ç¼–å†™çš„å‡½æ•°ä¹‹ä¸‹ï¼Œåœ¨ä¸Šé¢æ³„éœ²ä¿¡æ¯ä¸­äº†è§£åˆ°ç¨‹åºä»£ç æ®µåœ°å€ä¸º0x4005XX~0X4007XX,å¯ä»¥ä»0x400700å¼€å§‹è¿›è¡Œä¸€ä½çˆ†ç ´:

![](/assets/img/starCTF/blindpwn/14.png)

![](/assets/img/starCTF/blindpwn/15.png)

ğŸ‘†æ­¤å¤„éªŒè¯pop rbx~pop r15;retçš„gadgetåœ°å€ï¼Œå› ä¸ºå•å•éªŒè¯ä¸€ä¸ªpop XXX;retä¸èƒ½ç¡®å®šå…¶å°±æ˜¯pop rdi;retã€‚ å¯ä»¥çœ‹åˆ°å½“æº¢å‡ºåœ°å€ä¸º0x40077aæ—¶ï¼Œæ¥æ”¶6ä¸ªpopåæˆåŠŸæ‰§è¡Œä¸»å‡½æ•°ï¼Œè¯´æ˜0x40077aä¸º csu gadgetï¼Œæ ¹æ®å­—èŠ‚ç ä¸ªæ•°å¯ä»¥ç®—å‡ºpop rsièµ·å§‹åœ°å€ä¸ºcsu gadget+7ï¼Œpop rdièµ·å§‹åœ°å€ä¸ºcsu gadget+9ã€‚


æœ‰å¯ä»¥æ‰“å°å‡½æ•°çš„åœ°å€(0x400520)ï¼Œæœ‰pop rdiä¸pop rsiçš„åœ°å€(rdxè¿”å›æ—¶å›ºå®šä¸º0x100)ï¼Œå°±å¯ä»¥è¿›è¡Œä»»æ„åœ°å€è¯»ã€‚ä½¿ç”¨[Confused environment writeçš„æ–¹å¼äºŒ](https://dam0cles.github.io/2022/05/05/confused_envrionment_write.html#method_2),è·å¾—.dynamicã€.dynsymåŠ.dynstråœ°å€:

![](/assets/img/starCTF/blindpwn/16.png)

![](/assets/img/starCTF/blindpwn/17.png)

è·å–.dynsymã€.dynstråŠwriteçš„.got.pltä¸ä¸Šè¿°æµç¨‹ç±»ä¼¼ã€‚å¹¶å¾—çŸ¥0x400520ä¸ºwrite@pltã€‚


## æ„é€ getshell
ç¬¬ä¸€è½®å…ˆæ³„éœ²writeå‡½æ•°çš„.got.pltåœ°å€ä»¥è·å¾—libcåŸºå€ï¼Œç¬¬äºŒè½®æ„é€ system('/bin/sh\x00'):

![](/assets/img/starCTF/blindpwn/19.png)

![](/assets/img/starCTF/blindpwn/20.png)

## åè®°
æœ¬ç¯‡å­¦ä¹ æˆ‘åœ¨å¼€å§‹å‰æ²¡æœ‰çœ‹è¿‡BROPç›¸å…³èµ„æ–™ï¼Œæ•ˆç‡/æ‰‹æ³•å¯èƒ½ä¸å¦‚BROPé«˜æ˜ã€‚